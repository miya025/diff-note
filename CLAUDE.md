***

# CLAUDE.md

## プロダクト概要

本プロダクトは **GitHubのPR差分を解析し、コード変更からドキュメントを自動生成・更新するAI SaaS** です。

主な価値は以下です：

* PRを読まなくても「何が変わったか」が3分で分かる
* README / ADR / API変更点を自動で言語化
* **小規模チーム・個人開発者向けに特化**
* 日本語レビュー文化に最適化

本プロダクトは **Nimbic AIのフル機能版を目指さず**、以下にスコープを限定します。

---

## スコープ（重要）

### やること（MVP）

* GitHub PR作成時のWebhook受信
* PRのdiff取得（base...head）
* 差分を人間可読な単位に整形
* LLMによる変更点要約（日本語）
* 以下のドキュメント用テキスト生成（PRコメントとして提示）：
  * PRサマリー
  * READMEのRecent Changes追記用テキスト
  * ADR（Architecture Decision Record）のドラフト

### やらないこと（MVP時点）

* 全ファイル自動ドキュメント化
* Wiki / Confluence / Notion連携
* エンタープライズ機能
* リアルタイム編集UI
* **リポジトリへの直接的な自動コミット・自動マージ**

---

## 想定ユーザー

* 個人開発者
* 2〜10人規模のスタートアップ
* 日本語でレビュー・仕様共有を行うチーム

### ユーザーのペイン

* PRが長くて読むのが辛い
* ドキュメント更新が後回しになる
* 変更の意図が後から分からなくなる

---

## 基本動作フロー

1. ユーザーがGitHub Appをリポジトリにインストール
2. PR作成 or 更新
3. GitHub Webhookを受信
4. PR diffを取得
5. diffをファイル単位で整形
6. LLMで以下を生成：
   * 機能的変更点
   * 破壊的変更の有無
   * 利用者・影響範囲
7. GitHub PRコメントとして投稿（サマリー）
8. オプションでREADME / ADR用の追記テキストを生成し、コメントまたはSuggested Changesとして提示

---

## AIの役割定義（Claude / LLM）

Claudeは以下の役割を担います：

* **コードを設計意図レベルに翻訳する存在**
* 「何をしたか」ではなく「なぜ・何が変わったか」を言語化
* 日本語で、レビュー担当者向けに簡潔に要約

### 出力で重視する観点

* 意図（Intent）
* 影響範囲（Impact）
* 破壊的変更（Breaking Changes）
* 判断理由（ADR）

---

## プロンプト設計方針

### システムプロンプトの基本方針

* あなたは **シニアソフトウェアエンジニア**
* 対象読者は **PRレビュー担当者**
* 冗長な説明は禁止
* 実装詳細より「意味」を重視

### PRサマリー生成（例）

```text
あなたはシニアソフトウェアエンジニアです。
以下のGitHub PR差分を読み、
1. 主な変更点（3点以内）
2. 破壊的変更の有無
3. 影響を受ける利用者・機能
を日本語で簡潔にまとめてください。
```

### Few-shot（理想出力例）

#### 入力（要約されたdiff）

```text
- src/auth.ts
  - ログイン時にrefresh_tokenを発行
  - トークン有効期限ロジックを変更
```

#### 出力（理想）

```text
- 認証フローにリフレッシュトークン方式を追加
- トークン有効期限の管理ロジックを整理

破壊的変更: なし
影響範囲: 認証APIを利用するクライアント
```

---

## 出力品質ルール（重要）

### やってはいけない出力（Bad Examples）
- コード差分の逐語説明
- 変更行番号や変数名の羅列
- 根拠のない推測（「〜のためと思われる」）
- 冗長な背景説明

### 小さな変更の扱い（ノイズ防止）
以下の場合、原則として**PRサマリー生成をスキップ**する：
- 変更行数が10行未満
- docs / test / commentのみの変更
- PRに `skip-doc` ラベルが付与されている

---

## ドキュメント生成ルール

### PRサマリー
- 箇条書き
- 最大5行
- 技術用語は必要最低限

### README（Recent Changes）
- 時系列で追記できる形式
- 既存内容の削除・上書きはしない

### ADR
- 推奨ファイル名：`docs/adr/YYYYMMDD-title.md`
- 以下の構造を必ず守る

```markdown
# ADR-YYYYMMDD-タイトル

## Context

## Decision

## Consequences
```

---

## Diff前処理ルール

LLMに渡す前に必ず以下を行う：

* lockfile（package-lock.json 等）は除外
* テストコードは低優先度
* 変更行数が多い場合は要約
* ファイル単位で分割

---

## 技術スタック（前提）

* Backend: Node.js または FastAPI
* GitHub連携: GitHub App + Webhook
* LLM: Claude / OpenAI（差し替え可能）
* DB: SQLite / Supabase
* Auth: GitHub OAuth

---

## 品質基準

* PRコメントは **30秒以内** に返る
* 出力は必ず日本語
* 不確実な推測は断定しない
* コード内容を捏造しない

---

## 将来拡張（MVP後）

* 対応言語追加
* GitHub Check対応
* README自動commit（オプトイン）
* Slack通知
* チーム向け履歴ビュー

---

## 開発ポリシー

* 常に「個人開発者が自分で使いたいか」を基準に判断
* 機能追加より精度向上を優先
* UIは後回し、体験はPR上で完結させる

---

## このCLAUDE.mdの目的

このファイルは、Claude / LLMが **一貫した判断軸で出力を生成するための憲法** です。

曖昧な場合は、

> 「小規模チームの日本人エンジニアがPRレビューで助かるか？」
> を最優先で判断してください。